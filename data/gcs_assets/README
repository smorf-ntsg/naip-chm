================================================================================
            NAIP-CHM: A CANOPY HEIGHT MODEL (CHM) DATASET FOR CONUS
                        Google Cloud Storage Bucket
                           gs://naip-chm-assets
================================================================================

OVERVIEW
--------

This bucket contains Canopy Height Model (CHM) predictions derived from NAIP 
(National Agriculture Imagery Program) imagery covering the Continental United 
States (CONUS). CHMs were generated using a deep learning model trained to 
predict tree height from multispectral aerial imagery and auxiliary 
environmental features.

Total Assets: 213,567 Cloud-Optimized GeoTIFFs (COGs)
Total Volume: 24.82 TB
Coverage: CONUS (Continental United States)
Resolution: 0.6 meters 
Temporal Range: 2012-2023 (96% of data from 2022 - 2023)


BUCKET STRUCTURE
-----------------

The bucket is organized hierarchically by acquisition year and UTM zone:

gs://naip-chm-assets/
├── 2021/
│   ├── 10/
│   │   ├── m_QQQQQQQ_QQ_10_FFF_YYYYMMDD_chm.tif
│   │   ├── m_QQQQQQQ_QQ_10_FFF_YYYYMMDD_manifest.json
│   │   └── ...
│   ├── 11/
│   ├── 12/
│   └── ... (zones 10-19)
├── 2022/
│   ├── 10/
│   ├── 11/
│   └── ...
└── 2023/
    └── ...

Where:
- YEAR: 4-digit acquisition year (e.g., 2022)
- UTM_ZONE: 2-digit UTM zone number (10-19 for CONUS)
- Remaining path follows NAIP DOQQ naming convention


FILE NAMING CONVENTION
----------------------

CHM filenames directly correspond to source NAIP DOQQ imagery:

Format: m_QQQQQQQ_QQ_ZZ_FFF_YYYYMMDD[_YYYYMMDD]_chm.tif

Components:
  m           = Product type (mosaic)
  QQQQQQQ     = USGS 7.5-minute quadrangle ID
  QQ          = Quarter-quad position (nw, ne, sw, se)
  ZZ          = UTM zone number (10-19)
  FFF         = State FIPS code
  YYYYMMDD    = Acquisition date (imagery collection)
  YYYYMMDD    = Processing date (optional, NAIP mosaic processing)
  _chm        = Canopy Height Model suffix

Example:
  Source NAIP: m_1706601_sw_19_030_20221015_20230329.tif
  CHM Output:  m_1706601_sw_19_030_20221015_20230329_chm.tif
               └─ Same base name with _chm suffix


GEOSPATIAL FORMAT SPECIFICATIONS
---------------------------------

Data Type:       UInt16 (16-bit unsigned integer)
Units:           Centimeters (height × 100)
Value Range:     0-12000 (0-120 meters)
NoData Value:    65535
Resolution:      0.6 meters
Projection:      UTM (zone-specific, varies by file location)
                 EPSG codes: 32610-32619 (UTM zones 10N-19N)
Datum:           WGS84

COG Properties:
  Format:        Cloud-Optimized GeoTIFF (COG)
  Tiling:        512×512 pixel blocks
  Compression:   DEFLATE with predictor=2
  Overviews:     Yes (for efficient visualization)
  
Spatial Reference:
  Each file retains the UTM projection of its source NAIP imagery. Files are
  organized by UTM zone for efficient regional processing. The native projection
  matches the source NAIP quad for pixel-perfect alignment.


MANIFEST FILES
--------------

Each CHM has an accompanying JSON manifest containing processing metadata:

Format: {filename}_manifest.json

Contents:
  - Source NAIP filename and metadata
  - Acquisition date and day of year (DOY)
  - Geographic identifiers (UTM zone, quad ID)
  - Processing parameters (model version, chip size, overlap)
  - Quality metrics (chips processed, failed chips, processing time)
  - GCS path and Google Earth Engine asset path

Example manifest location:
  gs://naip-chm-assets/2022/19/m_1706601_sw_19_030_20221015_manifest.json


ACCESSING THE DATA
------------------

IMPORTANT: This is a REQUESTER PAYS bucket. Access requires:
  1. Authenticated Google Cloud account
  2. Active billing project attached to your account
  3. Budget approval for data egress costs

Data access will incur charges to YOUR billing project, not the bucket owner.
Estimated egress costs: ~$0.085 per GB (regional)

### Authentication

GCS authentication required. Use gcloud CLI or service account credentials:

  # User authentication (requires billing project)
  gcloud auth application-default login
  
  # Set your billing project
  gcloud config set project YOUR-PROJECT-ID

  # Or set service account credentials
  export GOOGLE_APPLICATION_CREDENTIALS="/path/to/service-account-key.json"


### Using gsutil (Command Line)

REQUESTER PAYS: Add -u flag with your billing project ID to all gsutil commands

List files for a specific year and UTM zone:
  gsutil -u YOUR-PROJECT-ID ls gs://naip-chm-assets/2022/19/

Download a single CHM:
  gsutil -u YOUR-PROJECT-ID cp gs://naip-chm-assets/2022/19/m_1706601_sw_19_030_20221015_chm.tif .

Download an entire year/zone:
  gsutil -u YOUR-PROJECT-ID -m cp -r gs://naip-chm-assets/2022/19/ ./local_directory/

Get file statistics:
  gsutil -u YOUR-PROJECT-ID du -sh gs://naip-chm-assets/2022/19/


### Using Python (google-cloud-storage)

REQUESTER PAYS: Specify user_project parameter in all operations

  from google.cloud import storage

  # Initialize client with your billing project
  client = storage.Client(project='YOUR-PROJECT-ID')
  bucket = client.bucket('naip-chm-assets', user_project='YOUR-PROJECT-ID')

  # List all CHMs for a specific year and zone
  blobs = bucket.list_blobs(prefix='2022/19/')
  for blob in blobs:
      if blob.name.endswith('_chm.tif'):
          print(f"gs://naip-chm-assets/{blob.name}")

  # Download a file (charges apply to YOUR-PROJECT-ID)
  blob = bucket.blob('2022/19/m_1706601_sw_19_030_20221015_chm.tif')
  blob.download_to_filename('local_chm.tif')

  # Read manifest
  import json
  manifest_blob = bucket.blob('2022/19/m_1706601_sw_19_030_20221015_manifest.json')
  manifest = json.loads(manifest_blob.download_as_text())


### Using GDAL/Rasterio (Virtual File System)

REQUESTER PAYS: Set environment variables for your billing project

  # Set environment variables for requester pays
  export GS_USER_PROJECT=YOUR-PROJECT-ID
  export GOOGLE_APPLICATION_CREDENTIALS=/path/to/credentials.json

Read directly from GCS without downloading:

  # GDAL
  gdalinfo /vsigs/naip-chm-assets/2022/19/m_1706601_sw_19_030_20221015_chm.tif

  # Python with rasterio
  import rasterio
  with rasterio.open('/vsigs/naip-chm-assets/2022/19/m_1706601_sw_19_030_20221015_chm.tif') as src:
      chm_data = src.read(1)  # Returns height in centimeters
      chm_meters = chm_data / 100.0  # Convert to meters


QUERYING BY REGION
------------------

Files are organized by UTM zone for efficient regional queries:

UTM Zone Coverage (approximate):
  Zone 10: Western US (Pacific coast, California, Oregon, Washington)
  Zone 11: Western US (Nevada, parts of California, Idaho, Montana)
  Zone 12: Western US (Utah, Arizona, Wyoming, Montana)
  Zone 13: Mountain West (Colorado, New Mexico, Wyoming, Montana)
  Zone 14: Central US (Kansas, Oklahoma, Texas, Dakotas)
  Zone 15: Central US (Iowa, Missouri, Arkansas, Louisiana, Minnesota)
  Zone 16: Midwest (Illinois, Wisconsin, Tennessee, Mississippi)
  Zone 17: East (Michigan, Indiana, Ohio, Kentucky, Georgia, Florida)
  Zone 18: East (Pennsylvania, New York, Carolinas, Virginia)
  Zone 19: Northeast (Maine, New England states)

GOOGLE EARTH ENGINE INTEGRATION
--------------------------------

All CHMs have been ingested into Google Earth Engine as COG-backed assets.

Image Collection:
  projects/naip-chm/assets/conus-structure-model

Asset Naming:
  projects/naip-chm/assets/conus-structure-model/{filename}_chm

Example Earth Engine Code:
  
  var collection = ee.ImageCollection('projects/naip-chm/assets/conus-structure-model');
  
  // Filter by date and region
  var chm = collection
    .filterDate('2022-01-01', '2022-12-31')
    .filterBounds(geometry)
    .mosaic();
  
  // Visualize (convert centimeters to meters)
  Map.addLayer(chm.divide(100), {min: 0, max: 30, palette: ['white', 'green']}, 'CHM');


DATA GENERATION METHODOLOGY
---------------------------

Processing Pipeline:
1. Input: 5-band NAIP imagery (R, G, B, NIR, Mask) at 0.6m resolution
2. Chip into overlapping 432×432 pixel tiles (20% overlap)
3. Extract auxiliary features at each chip center:
   - Elevation (digital elevation model)
   - Climate variables (PCA-transformed)
   - Soil properties (PCA-transformed)
   - Land cover class (NLCD)
   - Ecoregion (EPA Level III)
   - Day of year (sin/cos encoded)
4. Run deep learning inference
5. Crop and mosaic chips 
6. Convert predictions to centimeters (×100 scaling)
7. Save as Cloud-Optimized GeoTIFF

Model Architecture: U-Net with Feature-wise Linear Modulation
Training Data: USGS 3DEP lidar derived canopy height models
Model Version: See manifest files for specific model checkpoint

INDEX FILES
-----------

Complete asset inventories available in the top level of this bucket:

  gcs_assets_index.json - Structured JSON index with full metadata
  gcs_assets_index.csv  - Tabular CSV for analysis and filtering

CHANGELOG
---------

2025-11-19: Initial release of 213,567 CHM assets (24.82 TB) for CONUS.


LICENSE AND CITATION
--------------------

MIT License

Copyright (c) 2025 Scott L. Morford

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

Citation:
If you use this dataset, please cite:

A 0.6-meter resolution canopy height model for the contiguous United States
Authors: Scott L. Morford, Brady W. Allred, Shea P. Coons, Anthony A. Marcozzi, Sarah E. McCord, David E. Naugle

Note: There will first be a preprint at bioRxiv soon

Zenodo Archive: [Zenodo Repository URL to be added]

CONTACT 
-------

Contact: scott.morford@umontana.edu
GitHub Repository: [GitHub Repository URL to be added]

VERSION INFORMATION
-------------------

Bucket Created: October 2025
Last Updated: November 2025
Total Assets: 213,567 CHM GeoTIFFs
Data Version: 1.0

================================================================================
                            End of README
================================================================================
